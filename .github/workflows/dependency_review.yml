name: 'Dependency Review'

on: [ pull_request ]

permissions:
  contents: read

jobs:
  dependency_review:
    runs-on: ubuntu-latest

    steps:
      - name: 'Checkout Repository'
        uses: actions/checkout@v4

      # Configuration Options: https://github.com/actions/dependency-review-action/blob/main/README.md#configuration-options
      # Examples: https://github.com/actions/dependency-review-action/blob/main/docs/examples.md
      - name: Dependency Review
        id: dependency_review
        uses: actions/dependency-review-action@v3

      - name: Get Dependency Review
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          BASE_REF="${{ jobs.dependency_review.steps[dependency_review].with.base_ref || github.base_ref }}"
          HEAD_REF="${{ jobs.dependency_review.steps[dependency_review].with.head_ref || github.pull_request.head_ref }}"
          REPO="${{ github.repository }}"
          gh api \
            -H "Accept: application/vnd.github+json" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            "/repos/$REPO/dependency-graph/compare/$BASE_REF...$HEAD_REF"
